---
title: "Linear Model for IDMB data"
subtitle: "ASM Homework 1"
author: "Ricard Monge Amalia Vradi Maria Gkotsopoulou"
date: "3/10/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressWarnings(library(car))
suppressWarnings(library(corrplot))
suppressWarnings(library(dplyr))
suppressWarnings(library(effects))
suppressWarnings(library(emmeans))
suppressWarnings(library(ggplot2))
suppressWarnings(library(MASS))
suppressWarnings(library(multcomp))
```

## Exploratory data analysis

The **IDMB** dataset contains information of 940 films between 2000 and 2016.
The data has been obtained form the [IMDb](https:\\www.imdb.com) webpage. This is the list of the available variables:

VARIABLE        | DESCRIPTION                          
:--------------:|:-------------------------------------:
movietitle      | Movie titles
gross           | Gross Income of the movie, in dollars
budget          | Budget of the movie, in dollars
duration        | Movie duration, in minutes
titleyear       | Movie release year, from 2000 to 2016
directorfl      | Number of likes the Director has on Facebook
actor1fl        | Number of likes the Actor 1 has on Facebook
actor2fl        | Number of likes the Actor 2 has on Facebook
actor3fl        | Number of likes the Actor 3 has on Facebook
castfl          | Number of likes the Cast has on Facebook
facenumberinposter | Number of faces that appears in the movie poster.
genre           | Movie genre between Action/Comedy/Drama/Terror.

```{r data_load}
data <- read.table(file="IMDB.csv", header = T, sep = ";")
```

Our goal is to build a linear model to predict the gross product of a movie given it's characteristics.

Before proceeding to the model selection, we perorm pre-processing operations on the data as well as an exploratory data analysis.

Regarding the pre-processing, we first remove the *movietitle* variable as it will not play a role in our model. In addition, we have the *titleyear* variable which shows the movie year and that we want te discretize into 3 categories: 2000-2005, 2006-2010, 2010-2016.
```{r pre_processing}
movie_titles <- data$movietitle
data$movietitle <- NULL
data$titleyear <- ifelse(data$titleyear >= 2000 & data$titleyear <=2005,
                         "2000-2005",
                         ifelse(data$titleyear<=2010,
                                "2006-2010",
                                "2011-2016")) %>% 
  factor(., levels = c("2000-2005", "2006-2010", "2011-2016"))
```

  
We see the *gross* and *budget* variables have a great range, as well as the varibles of *likes*. We should consider transforming this variabls either by taking their logarithms or by dividing by a constant, for instance get the millions of dollars for the economic variables or the thousands of likes for the popularity variables.
```{r boxplots, fig.height=3.5}
par(mfrow=c(1,2))
boxplot(data[,c(1:2)], main="Boxplots Gross/Budget")
boxplot(data[,c(5:9)], main="Boxplots Likes")
par(mfrow=c(1,1))
```

## Model selection

### Complete model
 
We consider the full model, without interactions, to predict the *gross* target variable:


```{r complete_model}
lm.full <- lm(gross~.*(titleyear+genre),data)
summary(lm.full)
BIC(lm.full)
```

### Optimal model

In order to optimize the model, we performed a stepwise regression by computing the models with more and less predictors, keeping the one with lesser information criteria (BIC since we used the estimated paramater penalization k=log(n)).

```{r optimal_model}
k <- log(nrow(data))
lm.step <- stepAIC(lm.full, direction = "both", k = k, trace = 0)
summary(lm.step)
BIC(lm.step)
```
### Multicollinearity

It is convenient to check if the predictors used in the previous models have multicollinearity to check the validity and correctness of our models.

First we look at the pair-to-pair scatter plots:

```{r multicollinearity_pairs, warning=FALSE}
scatterplotMatrix(~gross+budget+duration+directorfl+actor1fl+castfl|genre, data, col=2:4)
```

We can see that the variable pairs *budget-duration* and *actor1fl-castfl* seem to be correlated. However, in order to ensure this collinearity, we calculate the variable's correlation.

```{r multicollinearity}
data.numeric <- data[,-which(colnames(data) %in% c("titleyear","genre"))]
var.cor <- cor(data.numeric)
corrplot(var.cor, method = "circle",type = "upper")
```

We can see only the pair *actor1fl-castfl* seems have a significant correlation.

Another way to check for the multicollinearity is to compute the VIF coefficients of each variable.

```{r multicollinearity_vif}
vif(lm.step)
```

## Model validation

```{r model_validation}
residualPlots(lm.step)
```

## Model interpretation

```{r model_interpretation}
effects <- allEffects(lm.step)
plot(effects, "budget:titleyear")
plot(effects, "duration:genre")
plot(effects, "titleyear:directorfl")
plot(effects, "actor1fl")
plot(effects, "castfl")
```